{
  "userInputs": [
    {
      "id": "content-url-input",
      "type": "input",
      "name": "Original Content URL",
      "description": "Enter the URL of the original content to translate (e.g., https://dev-www.frevana.com/content/article-title-content-id)",
      "placeholder": "https://dev-www.frevana.com/content/...",
      "required": true
    },
    {
      "id": "target-languages-input",
      "type": "keywords",
      "name": "Target Languages (comma-separated)",
      "description": "Enter language codes separated by commas (e.g., zh, ja, es, fr, de)",
      "placeholder": "zh, ja, es",
      "required": true
    }
  ],
  "workflows": [
    {
      "id": "batch-translate-all",
      "nameV2": "Batch Translate All Languages",
      "type": "script",
      "outputFormat": "text",
      "script": "module.exports = async function() {\n  const contentUrl = data['content-url-input'] || '';\n  const languagesStr = data['target-languages-input'] || '';\n  \n  if (!contentUrl) {\n    throw new Error('Content URL is required');\n  }\n  \n  if (!languagesStr) {\n    throw new Error('Target languages are required');\n  }\n  \n  // Parse target languages\n  const languages = languagesStr.split(',').map(lang => lang.trim().toLowerCase()).filter(Boolean);\n  \n  if (languages.length === 0) {\n    throw new Error('No valid languages found');\n  }\n  \n  console.log(`Starting batch translation to ${languages.length} languages: ${languages.join(', ')}`);\n  \n  // Extract content ID from URL\n  const urlParts = contentUrl.split('/');\n  const lastPart = urlParts[urlParts.length - 1];\n  const segments = lastPart.split('-');\n  const contentId = segments[segments.length - 1];\n  \n  if (!contentId || contentId.length < 10) {\n    throw new Error(`Invalid content ID extracted from URL: ${contentId}`);\n  }\n  \n  console.log(`Content ID: ${contentId}`);\n  \n  // Download original content once\n  console.log('Downloading original content...');\n  const contentResponse = await api.frevanaApi.request('GET', `/s3/content/${contentId}`);\n  \n  if (!contentResponse.ok || !contentResponse.data) {\n    throw new Error(`Failed to get content info: ${JSON.stringify(contentResponse)}`);\n  }\n  \n  let originalContentUrl = contentResponse.data.url;\n  if (!originalContentUrl.startsWith('http://') && !originalContentUrl.startsWith('https://')) {\n    originalContentUrl = `https://${originalContentUrl}`;\n  }\n  \n  const htmlResponse = await api.fetch(originalContentUrl);\n  const originalHtml = await htmlResponse.text();\n  \n  if (!originalHtml || originalHtml.length === 0) {\n    throw new Error('Downloaded content is empty');\n  }\n  \n  console.log(`Downloaded original content: ${originalHtml.length} characters`);\n  \n  // Process each language\n  const results = [];\n  \n  for (const targetLang of languages) {\n    try {\n      console.log(`\\n[${targetLang}] Starting translation...`);\n      \n      // Check if translation already exists\n      const versionsResponse = await api.frevanaApi.request(\n        'GET',\n        `/s3/content/${contentId}/language-versions`\n      );\n      \n      let existingTranslation = null;\n      if (versionsResponse.ok && versionsResponse.data && versionsResponse.data.versions) {\n        existingTranslation = versionsResponse.data.versions.find(\n          (v) => v.language_code === targetLang\n        );\n      }\n      \n      if (existingTranslation) {\n        console.log(`[${targetLang}] Translation already exists, skipping`);\n        results.push({\n          language: targetLang,\n          status: 'existing',\n          contentId: existingTranslation.content_id,\n          url: existingTranslation.url\n        });\n        continue;\n      }\n      \n      // Prepare translation\n      console.log(`[${targetLang}] Preparing new translation...`);\n      const prepareResponse = await api.frevanaApi.request(\n        'POST',\n        `/s3/content/${contentId}/prepare-translate`,\n        { target_language: targetLang }\n      );\n      \n      if (!prepareResponse.ok) {\n        throw new Error(`Failed to prepare translation: ${JSON.stringify(prepareResponse.data)}`);\n      }\n      \n      const prepareData = prepareResponse.data;\n      console.log(`[${targetLang}] Prepared. New content ID: ${prepareData.new_content_id}`);\n      \n      // Store data for this language to pass to AI node\n      results.push({\n        language: targetLang,\n        status: 'pending',\n        contentId: prepareData.new_content_id,\n        uploadUrl: prepareData.upload_url,\n        needsTranslation: true\n      });\n      \n    } catch (error) {\n      console.error(`[${targetLang}] Error:`, error.message);\n      results.push({\n        language: targetLang,\n        status: 'error',\n        error: error.message\n      });\n    }\n  }\n  \n  // Return JSON with original HTML and all language metadata\n  return JSON.stringify({\n    originalHtml: originalHtml,\n    contentId: contentId,\n    languages: results\n  });\n};",
      "nodeIds": ["content-url-input", "target-languages-input"]
    },
    {
      "id": "translate-and-upload",
      "nameV2": "Translate and Upload All",
      "type": "script",
      "outputFormat": "text",
      "script": "module.exports = async function() {\n  const batchData = JSON.parse(data['batch-translate-all'] || '{}');\n  const originalHtml = batchData.originalHtml || '';\n  const languagesData = batchData.languages || [];\n  \n  if (!originalHtml) {\n    throw new Error('Original HTML not found');\n  }\n  \n  const results = [];\n  \n  for (const langData of languagesData) {\n    const targetLang = langData.language;\n    \n    try {\n      // Skip if already exists or had error\n      if (langData.status === 'existing') {\n        console.log(`[${targetLang}] Using existing translation`);\n        results.push(langData);\n        continue;\n      }\n      \n      if (langData.status === 'error' || !langData.needsTranslation) {\n        results.push(langData);\n        continue;\n      }\n      \n      // Translate with AI (simulate AI call - in real workflow this would be an ai_prompt node)\n      console.log(`[${targetLang}] Translating with AI...`);\n      \n      // For now, we'll mark as needing AI translation\n      // In the actual workflow, you would call AI here or in a separate node\n      results.push({\n        ...langData,\n        status: 'need_ai_translation',\n        originalHtml: originalHtml\n      });\n      \n    } catch (error) {\n      console.error(`[${targetLang}] Error:`, error.message);\n      results.push({\n        ...langData,\n        status: 'error',\n        error: error.message\n      });\n    }\n  }\n  \n  return JSON.stringify({\n    contentId: batchData.contentId,\n    results: results\n  });\n};",
      "nodeIds": ["batch-translate-all"]
    },
    {
      "id": "format-summary",
      "nameV2": "Format Summary Report",
      "type": "ai_prompt",
      "outputFormat": "text",
      "prompt": "Create a summary report of the translation batch process.\n\nTranslation Data:\n@[Step-2 Translate and Upload All](translate-and-upload)\n\nFormat as markdown with:\n1. Overall statistics (total languages, successful, failed, existing)\n2. Details for each language\n3. Any errors or warnings\n\nMake it clear and easy to read.",
      "nodeIds": ["translate-and-upload"]
    }
  ],
  "results": [
    {
      "type": "plain_text",
      "fields": [],
      "items": { "content": "format-summary" }
    }
  ],
  "inputValues": {
    "content-url-input": [],
    "target-languages-input": []
  },
  "version": "1.0",
  "metadata": {
    "author": "Frevana-AI",
    "createdAt": "2025-12-15T11:00:00.000Z",
    "description": "Multi-language content translation workflow using batch processing (no loop)"
  },
  "frequency": "-1",
  "mcpConfigs": {},
  "workflowConnects": []
}
