{
  "userInputs": [
    {
      "id": "content-url-input",
      "type": "input",
      "name": "Original Content URL",
      "description": "Enter the URL of the original content to translate (e.g., https://dev-www.frevana.com/content/article-title-content-id)",
      "placeholder": "https://dev-www.frevana.com/content/...",
      "required": true
    },
    {
      "id": "target-languages-input",
      "type": "keywords",
      "name": "Target Languages (comma-separated)",
      "description": "Enter language codes separated by commas (e.g., zh, ja, es, fr, de)",
      "placeholder": "zh, ja, es",
      "required": true
    }
  ],
  "workflows": [
    {
      "id": "batch-process-all-languages",
      "nameV2": "Batch Process All Languages",
      "type": "script",
      "outputFormat": "text",
      "script": "module.exports = async function() {\n  const contentUrl = data['content-url-input'] || '';\n  const languagesStr = data['target-languages-input'] || '';\n  \n  if (!contentUrl) {\n    throw new Error('Content URL is required');\n  }\n  \n  if (!languagesStr) {\n    throw new Error('Target languages are required');\n  }\n  \n  // Parse target languages\n  const languages = languagesStr.split(',').map(lang => lang.trim().toLowerCase()).filter(Boolean);\n  \n  if (languages.length === 0) {\n    throw new Error('No valid languages found');\n  }\n  \n  console.log(`\\n=== Starting batch translation ===`);\n  console.log(`Target languages (${languages.length}): ${languages.join(', ')}`);\n  \n  // Extract content ID from URL\n  const urlParts = contentUrl.split('/');\n  const lastPart = urlParts[urlParts.length - 1];\n  const segments = lastPart.split('-');\n  const contentId = segments[segments.length - 1];\n  \n  if (!contentId || contentId.length < 10) {\n    throw new Error(`Invalid content ID extracted from URL: ${contentId}`);\n  }\n  \n  console.log(`Content ID: ${contentId}`);\n  \n  // Download original content once\n  console.log('\\n[Step 1] Downloading original content...');\n  const contentResponse = await api.frevanaApi.request('GET', `/s3/content/${contentId}`);\n  \n  if (!contentResponse.ok || !contentResponse.data) {\n    throw new Error(`Failed to get content info`);\n  }\n  \n  let originalContentUrl = contentResponse.data.url;\n  if (!originalContentUrl.startsWith('http://') && !originalContentUrl.startsWith('https://')) {\n    originalContentUrl = `https://${originalContentUrl}`;\n  }\n  \n  const htmlResponse = await api.fetch(originalContentUrl);\n  const originalHtml = await htmlResponse.text();\n  \n  if (!originalHtml || originalHtml.length === 0) {\n    throw new Error('Downloaded content is empty');\n  }\n  \n  console.log(`âœ“ Downloaded: ${originalHtml.length} characters\\n`);\n  \n  // Process each language\n  console.log('[Step 2] Processing translations...');\n  const results = [];\n  \n  for (let i = 0; i < languages.length; i++) {\n    const targetLang = languages[i];\n    console.log(`\\n--- [${i+1}/${languages.length}] Language: ${targetLang} ---`);\n    \n    try {\n      // Check if translation already exists\n      console.log(`  Checking existing translations...`);\n      const versionsResponse = await api.frevanaApi.request(\n        'GET',\n        `/s3/content/${contentId}/language-versions`\n      );\n      \n      let existingTranslation = null;\n      if (versionsResponse.ok && versionsResponse.data && versionsResponse.data.versions) {\n        existingTranslation = versionsResponse.data.versions.find(\n          (v) => v.language_code === targetLang\n        );\n      }\n      \n      if (existingTranslation) {\n        console.log(`  âœ“ Translation already exists (ID: ${existingTranslation.content_id})`);\n        results.push({\n          language: targetLang,\n          status: 'existing',\n          contentId: existingTranslation.content_id,\n          url: existingTranslation.url,\n          title: existingTranslation.title || 'Translated Content'\n        });\n        continue;\n      }\n      \n      // Prepare translation\n      console.log(`  Preparing new translation...`);\n      const prepareResponse = await api.frevanaApi.request(\n        'POST',\n        `/s3/content/${contentId}/prepare-translate`,\n        { target_language: targetLang }\n      );\n      \n      if (!prepareResponse.ok) {\n        throw new Error(`Failed to prepare: ${JSON.stringify(prepareResponse.data)}`);\n      }\n      \n      const prepareData = prepareResponse.data;\n      console.log(`  âœ“ Prepared (New ID: ${prepareData.new_content_id})`);\n      \n      // Store for AI translation step\n      results.push({\n        language: targetLang,\n        status: 'need_translation',\n        contentId: prepareData.new_content_id,\n        uploadUrl: prepareData.upload_url,\n        originalLanguage: prepareData.original_language\n      });\n      \n    } catch (error) {\n      console.error(`  âœ— Error: ${error.message}`);\n      results.push({\n        language: targetLang,\n        status: 'error',\n        error: error.message\n      });\n    }\n  }\n  \n  console.log(`\\n=== Batch processing completed ===`);\n  console.log(`Total: ${results.length}, Existing: ${results.filter(r => r.status === 'existing').length}, New: ${results.filter(r => r.status === 'need_translation').length}, Errors: ${results.filter(r => r.status === 'error').length}\\n`);\n  \n  // Return data for next step (AI translation)\n  return JSON.stringify({\n    originalHtml: originalHtml,\n    contentId: contentId,\n    results: results\n  });\n};",
      "nodeIds": ["content-url-input", "target-languages-input"]
    },
    {
      "id": "translate-upload-confirm",
      "nameV2": "Translate, Upload & Confirm All",
      "type": "script",
      "outputFormat": "text",
      "script": "module.exports = async function() {\n  const batchData = JSON.parse(data['batch-process-all-languages'] || '{}');\n  const originalHtml = batchData.originalHtml || '';\n  const preparedResults = batchData.results || [];\n  \n  if (!originalHtml) {\n    throw new Error('Original HTML not found');\n  }\n  \n  console.log(`\\n[Step 3] Translating, uploading and confirming...`);\n  const finalResults = [];\n  \n  for (const result of preparedResults) {\n    const lang = result.language;\n    \n    try {\n      // Skip if already exists or had error\n      if (result.status === 'existing') {\n        console.log(`\\n[${lang}] Using existing translation`);\n        finalResults.push(result);\n        continue;\n      }\n      \n      if (result.status === 'error') {\n        finalResults.push(result);\n        continue;\n      }\n      \n      // Need translation\n      if (result.status === 'need_translation') {\n        console.log(`\\n[${lang}] Translating with AI (${originalHtml.length} characters)...`);\n        \n        // Call AI translation (this will be replaced with actual AI call)\n        // For now, store the data needed for external AI translation\n        finalResults.push({\n          ...result,\n          status: 'ready',\n          note: 'Translation prepared - needs AI translation step',\n          originalHtmlLength: originalHtml.length\n        });\n      }\n      \n    } catch (error) {\n      console.error(`[${lang}] Error: ${error.message}`);\n      finalResults.push({\n        ...result,\n        status: 'error',\n        error: error.message\n      });\n    }\n  }\n  \n  console.log(`\\n[Step 3] Processing completed`);\n  \n  return JSON.stringify({\n    contentId: batchData.contentId,\n    results: finalResults\n  });\n};",
      "nodeIds": ["batch-process-all-languages"]
    },
    {
      "id": "format-translation-report",
      "nameV2": "Format Translation Report",
      "type": "ai_prompt",
      "outputFormat": "text",
      "prompt": "Create a beautiful markdown report for the multi-language translation results.\n\nTranslation Data (JSON):\n@[Step-2 Translate, Upload & Confirm All](translate-upload-confirm)\n\nIMPORTANT:\n- Parse the JSON data above to extract translation results\n- Create a clear, professional markdown report\n\nReport Structure:\n\n# ğŸŒ Multi-Language Translation Results\n\n## ğŸ“Š Overall Statistics\n- **Total Languages**: [number]\n- **Successfully Translated**: [number of 'ready' status]\n- **Already Existing**: [number of 'existing' status]\n- **Errors**: [number of 'error' status]\n\n## ğŸ“ Translation Details\n\nFor each language, create a section like:\n\n### [Flag] [Language Name] (`[code]`)\n- **Status**: [Ready âœ… / Existing â™»ï¸ / Error âŒ]\n- **Content ID**: `[contentId]`\n- **Preview URL**: [if available, make it clickable]\n- **Note**: [any additional notes]\n\nLanguage Flags Reference:\n- ğŸ‡¨ğŸ‡³ Chinese (zh)\n- ğŸ‡¯ğŸ‡µ Japanese (ja)\n- ğŸ‡ªğŸ‡¸ Spanish (es)\n- ğŸ‡«ğŸ‡· French (fr)\n- ğŸ‡©ğŸ‡ª German (de)\n- ğŸ‡°ğŸ‡· Korean (ko)\n- ğŸ‡µğŸ‡¹ Portuguese (pt)\n- ğŸ‡®ğŸ‡¹ Italian (it)\n- ğŸ‡·ğŸ‡º Russian (ru)\n- ğŸ‡³ğŸ‡± Dutch (nl)\n\n## ğŸ’¡ Next Steps\n\nFor 'ready' status translations:\n1. Content has been prepared and is ready for translation\n2. Click the preview URL once translation is complete to view the result\n\nFor 'existing' translations:\n- Translation already exists, you can view it using the preview URL\n\nFor errors:\n- Review the error message and retry if needed\n\n---\n\n*Generated by Frevana Multi-Language Translation Workflow*\n\nMake it visually appealing, professional, and easy to scan!",
      "model": "gpt-5.1",
      "nodeIds": ["translate-upload-confirm"]
    }
  ],
  "results": [
    {
      "type": "plain_text",
      "fields": [],
      "items": { "content": "format-translation-report" }
    }
  ],
  "inputValues": {
    "content-url-input": [],
    "target-languages-input": []
  },
  "version": "1.0",
  "metadata": {
    "author": "Frevana-AI",
    "createdAt": "2025-12-15T10:00:00.000Z",
    "description": "Multi-language content translation workflow with loop support"
  },
  "frequency": "-1",
  "mcpConfigs": {},
  "workflowConnects": []
}
